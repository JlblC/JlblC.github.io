<!DOCTYPE html>
<html><head><title> race gen &beta; </title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<popbody><noscript><span>_ Your browser does not support JavaScript! _</span></noscript></popbody>
<script>
function parsehash() {
	var result={},a=[],pairs=window.location.hash.slice(1).split('&');
	for (var i=0; i < pairs.length; i++) {
		a = pairs[i].split('=');
		result[a[0]]=a[1];		
	}
	return result;
}

// создание элемента
function $e(tag, parent, className, attributes,content,style) {
	var result = document.createElement(tag);
	if (className)  result.className = className;
	if (parent) parent.appendChild(result);
	if (attributes) for (var a in attributes) result.setAttribute(a, attributes[a]);
	if (content) result.innerHTML = content;
	if (style) for (var a in style) result.style[a] = style[a];
	return result;
}</script>
<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<script type="text/javascript">
//"use strict"

Math.tanh = function (arg) {return (Math.exp(arg) - Math.exp(-arg)) / (Math.exp(arg) + Math.exp(-arg))};
Math.cosh = function (arg) {return (Math.exp(arg) + Math.exp(-arg)) / 2;};

// Load the Visualization API and the piechart package.
google.load('visualization','1.0', {'packages': ['table'],'nocss':true});
      
// Set a callback to run when the Google Visualization API is loaded.
google.setOnLoadCallback(main);
console.log('header');
	
$e('link',document.head,null,{type:'text/css',rel:'stylesheet',href:((window.location.protocol.toString().search('file')!= -1)?'../Public':'')+'/frombootstrap.css'});

var theAbacus=[[ -0.20 ,  2.00 ,  0.00 ,  1.00 , -0.20 ,  0.12 ,  0.00 ,  0.00] , 
               [  0.02 , -0.90 ,  0.00 ,  0.30 ,  0.25 ,  0.60 ,  0.00 , -0.06] , 
               [  0.13 ,  0.05 , -0.37 ,  0.13 ,  0.09 , -0.12 , -0.14 ,  0.10] , 
               [  0.00 , -0.20 , -0.12 , -0.46 ,  0.00 , -0.26 ,  0.60 , -0.20] , 
               [ -0.30 ,  0.27 , -0.20 , -0.20 ,  0.15 , -0.53 ,  0.45 ,  0.20] , 
               [  0.20 ,  0.00 ,  0.00 , -0.27 , -0.70 , -0.60 , -0.10 ,  0.00] , 
               [  0.10 , -0.20 ,  0.40 , -0.60 ,  0.10 ,  0.30 , -0.30 , -0.10] , 
               [  0.12 , -0.15 ,  0.11 ,  0.12 ,  0.10 ,  0.00 ,  0.50 , -0.10] , 
               [ -0.60 ,  0.21 , -0.20 , -0.38 ,  0.20 , -0.30 ,  0.20 ,  0.60] , 
               [ -0.50 ,  0.00 ,  0.20 ,  0.10 ,  0.00 , -0.45 ,  0.80 ,  0.68] , 
               [  0.06 ,  0.00 ,  0.20 ,  0.10 ,  0.35 , -0.18 , -0.50 ,  0.60] , 
               [  0.09 ,  0.30 , -0.10 ,  0.00 , -0.16 ,  0.25 ,  0.42 , -0.65] , 
               [ -0.45 ,  0.00 ,  0.00 , -0.25 , -0.09 , -0.20 , -0.24 , -0.60] ];
               
var nlAbacus =[[ "-0.20 * x" , " 2.00 * x" , " 0.00    " , " 1.00 * x" , "-0.20 * x" , " 0.12 * x" , " 0.00    " , " 0.00    " ] , 
               [ " 0.02 * x" , "-0.90 * x" , " 0.00    " , " 0.30 * x" , " 0.25 * x" , " 0.60 * x" , " 0.00    " , "-0.06 * x" ] , 
               [ " 0.13 * x" , " 0.05 * x" , "-0.37 * x" , " 0.13 * x" , " 0.09 * x" , "-0.12 * x" , "-0.14 * x" , " 0.10 * x" ] , 
               [ " 0.00    " , "-0.20 * x" , "-0.12 * x" , "-0.46 * x" , " 0.00    " , "-0.26 * x" , " 0.60 * x" , "-0.20 * x" ] , 
               [ "-0.30 * x" , " 0.27 * x" , "-0.20 * x" , "-0.20 * x" , " 0.15 * x" , "-0.53 * x" , " 0.45 * x" , " 0.20 * x" ] , 
               [ " 0.20 * x" , " 0.00    " , " 0.00    " , "-0.27 * x" , "-0.70 * x" , "-29.4 * (-1e-8 * x*x*x*x*x + 0.04143333 * x)" , "-0.10 * x" , " 0.00    " ] , 
               [ " 0.10 * x" , "-0.20 * x" , " 0.40 * x" , "-0.60 * x" , " 0.10 * x" , " 0.30 * x" , "-0.30 * x" , "-0.10 * x" ] , 
               [ " 0.12 * x" , "-0.15 * x" , " 0.11 * x" , " 0.12 * x" , " 0.10 * x" , " 0.00    " , " 0.50 * x" , "-0.10 * x" ] , 
               [ "-0.60 * x" , " 0.21 * x" , "-0.20 * x" , "-0.38 * x" , " 0.20 * x" , "-0.30 * x" , " 0.20 * x" , " 0.60 * x" ] , 
               [ "-0.50 * x" , " 0.00    " , " 0.20 * x" , " 0.10 * x" , " 0.00    " , "-0.45 * x" , " 0.80 * x" , " 0.68 * x" ] , 
               [ " 0.06 * x" , " 0.00    " , " 0.20 * x" , " 0.10 * x" , " 0.35 * x" , "-0.18 * x" , "-0.50 * x" , "29.4*(2*tanh(0.1*x)/cosh(0.1*x))" ] , 
               [ " 0.09 * x" , " 0.30 * x" , "-0.10 * x" , " 0.00    " , "-0.16 * x" , " 0.25 * x" , " 0.42 * x" , "-0.65 * x" ] , 
               [ "-0.45 * x" , " 0.00    " , " 0.00    " , "-0.25 * x" , "-0.09 * x" , "-0.20 * x" , "-0.24 * x" , "-0.60 * x" ] ];

			   
var newAbacus=[[ -0.20 ,  2.00 ,  0.00 ,  1.00 , -0.20 ,  0.12 ,  0.00 ,  0.00] , 
               [  0.02 , -0.90 ,  0.00 ,  0.30 ,  0.25 ,  0.60 ,  0.00 , -0.06] , 
               [  0.13 ,  0.05 , -0.37 ,  0.13 ,  0.09 , -0.12 , -0.14 ,  0.10] , 
			   [  0.20 ,  0.00 , -0.10 ,  0.15 , -0.10 ,  0.20 , -0.25 , -0.20] , // дальность
               [  0.00 , -0.20 , -0.12 , -0.46 ,  0.00 , -0.26 ,  0.60 , -0.20] , 
               [ -0.30 ,  0.27 , -0.20 , -0.20 ,  0.15 , -0.53 ,  0.45 ,  0.20] , // цены
               [  0.20 ,  0.00 ,  0.00 , -0.27 , -0.70 , -0.60 , -0.10 ,  0.00] , // наука
               [  0.10 , -0.20 ,  0.40 , -0.60 ,  0.10 ,  0.30 , -0.30 , -0.10] , 
               [  0.12 , -0.15 ,  0.11 ,  0.12 ,  0.10 ,  0.00 ,  0.50 , -0.10] , //скор воен
               [ -0.60 ,  0.21 , -0.20 , -0.38 ,  0.20 , -0.30 ,  0.20 ,  0.60] , // прочность
               [ -0.50 ,  0.00 ,  0.20 ,  0.10 ,  0.00 , -0.45 ,  0.80 ,  0.68] , // лазеры
			   [ -0.50 ,  0.00 ,  0.80 ,  0.30 , -0.70 ,  0.40 ,  0.25 , -0.15] , // ракеты
               [  0.06 ,  0.00 ,  0.20 ,  0.10 ,  0.35 , -0.18 , -0.50 ,  0.60] , 			   
			   [  0.03 , -0.10 , -0.20 ,  0.05 ,  0.17 ,  0.09 , -0.25 ,  0.30], // вторичка
			   [  0.05 ,  0.00 ,  0.05 ,  0.10 ,  0.10 ,  0.20 ,  0.60 , -0.60] , // кредиты
			   [ -0.20 , -0.60 , -0.16 , -0.16 , -0.16 , -0.16 , +0.16 , +0.44] , // ВНК
			   [  0.00 ,  0.00 ,  0.00 ,  0.00 ,  0.00 ,  0.00 ,  0.00 ,  0.00] , // скорость ВНК			   
               [  0.09 ,  0.30 , -0.10 ,  0.00 , -0.16 ,  0.25 ,  0.42 , -0.65] , // невидимость
               [ -0.45 ,  0.00 ,  0.00 , -0.25 , -0.09 , -0.20 , -0.24 , -0.60] 
			   ];
var primlabels=["Зануды","Романтики",
	"Хрупкие","Живучие",
	"Странники","Оседлые",
	"Долгожители","Однодневки",
	"Умники","Плодовитые",
	"Древние","Молодые",
	"Торгаши","Вояки",
	"Крохи","Великаны",
	"Ресурсы","",
	"Температура",""];

var seclabels=[
	"Комфортная температура",
	"Бонус прироста популяции",
	"Скорость и дальность полёта",
	"Защитные системы",
	"Цены",
	"Наука",
	"Скорость мирного производства",
	"Скорость военного производства",
	"Прочность юнитов и построек",
	"Повреждения",
	"Добыча ресурсов",
	"Невидимость",
	"Обнаружение невидимок"];

var newseclabels=[
	"Температура",
	"Прирост популяции",
	"Скорость полёта",
	"Дальность полёта",
	"Защитные системы",
	"Цены",
	"Наука",
	"Скорость мирного",
	"Скорость военного",
	"Прочность",
	"Повреждения лазерами",
	"Повреждения ракетами",
	"Добыча первички",
	"Добыча вторички",
	"Добыча кредитов",
	"Бонус ВНК",
	"Скорость роста ВНК",
	"Невидимость",
	"Обнаружение"];
	

var globalvars={}; 

var datasecpar,dataraceslist;
var sectable,raceslisttable,terttable;


var barformatter,titlformatter,editformatter;
var view;

var calcconst={};


theRaces = [new Array("Ancient Idols", 30, 70, 20, 20, 30, 10, 50, 60, "11", "GribUser", "Одна из первых стандартных рас."), new Array("ProTech", 50, 90, 50, 60, 60, 35, 60, 50, "11", "GribUser", "*"), new Array("Humans", 65, 70, 40, 60, 60, 70,
40, 50, "11", "GribUser", "*"), new Array("Dark Herders", 80, 40, 90, 30, 20, 40, 50, 20, "11", "GribUser", "*"), new Array("Silicoids", 40, 20, 80, 20, 50, 40, 50, 50, "11", "GribUser", "*"), new Array("PsiInsects", 80, 80, 50, 70, 70, 60, 70, 30, "11", "GribUser", "*"), new Array("mHumans", 60, 45, 35, 60, 65, 70, 60, 45, "12", "klonZona, «Хуманс" + "ы»", "Всего понемногу, где плюс, где минус. Хотя слабый боевой оттенок у расы есть, как следствие безалаберности, эмоциональности и, соответственно, некоторой агрессивности. В силу тех же качеств являют, правда, из себя противоположность «Techs» – активное размножение в ущерб науке. Не ленивые и не" + " жадные – добыча вровень с ценами. Умеют сносно прятаться благодаря врожденной смекалке и хорошей реакции."), new Array("Fatas", 90, 55, 45, 10, 90, 60, 35, 15, "12", "klonZona, «Феечки»", "Предпочитают умеренный климат, беззаботны, недисциплинированы. Драться не умеют совершенно, но попасть по ним трудно из-" + "за вертлявости и малых размеров. Обожают что-нибудь мастерить, начиная от мелкой домашней утвари и заканчивая замысловатыми ажурными сводами архитектурных сооружений. Умеют неплохо прятаться и имеют привычку всюду совать свой нос."), new Array("Techs", 90, 70, 65, 25, 10, 60, 10, 65, "12", "klonZona, «Умники" + "»", "Типичные яйцеголовые вундеркиндеры с растущими не из того места руками. Из физической работы хорошо справляются только с примитивной – добыча ресурсов и постройка зданий из наборных панелей. Экономика процветает, но размножаются они плохо, процессу спаривания предпочитают заумные дискуссии. Во" + "яки никудышные. К климату относительно терпимы, поскольку вне стен своих обиталищ оказываются редко и на минимальный срок, но толкового кондиционирования все равно обеспечить не могут."), new Array("Rage Stones", 90, 80, 75, 30, 60, 10, 70, 90, "12", "klonZona, «Вояки»", "Очень древнее и очень кровожадное пле" + "мя с балансиреющей на грани банкротства экономикой. Спасает положение только постоянное пополнение каторжных рудников новыми работниками. Собственнические инстинкты гипертрофированы, неприхотливы к условиям обитания, превосходные солдаты. Из-за высокой смертности в непрекращающихся вендеттах приро" + "ст населения низкий."), new Array("Dark Watchers", 30, 30, 25, 85, 5, 45, 25, 10, "12", "GribUser по мотивам расы «Шпиены», © klonZona", "Активные параноики. Никакая работа у них не ладится, потому что они больше времени тратят на подглядывание и подслушивание за ближними своими, чем на прямые свои обязанност" + "и. Экономика даже хуже, чем у вояк. Удивительно неплохо размножаются – каждое семейство старается взрастить побольше своих «агентов» для внедрения к соседям."), new Array("Wanderers", 90, 70, 20, 70, 90, 75, 25, 75, "12", "klonZona, «Бродяги»", "У этих отрытый космос – дом родной. Летают прилично, закалены – " + "живут где попало, умеют воду из камня выдавить при необходимости – повышенная добыча. Науками не интересуются, производством занимаются лишь по необходимости. Воюют тоже не ахти, хотя вследствие бродячего образа жизни по прочности слегка превосходят остальных не-вояк"), new Array("Grayers", 50, 50, 50,
50, 50, 50, 50, 50, "12", "GribUser", "Серая и ничем не примечательная раса. Они летают со средней скоростью, покупают по средним ценам и селятся на средних планетах. Несмотря на серость каждого представителя расы в отдельности, управляющий ими имеет все шансы преуспеть – тотальное отсутствие слабых сторо" + "н может оказаться самым ценным положительным качеством."), new Array("Worms", 99, 39, 99, 99, 99, 1, 1, 99, "13", "Tektronix", "Созданные в секретных лабораториях биороботы-шахтеры. Говорят, это все, что осталось во вселенной от Хумансов. Планета, заселенная червями, напоминает кусок сыра: они выкопают самую " + "тонкую жилу, а затем извлекут из нее все нужные минералы, до последней крошки. Затем черви выходят на поверхность – только для того, чтобы сесть на корабль и отправиться перекапывать следующую планету. Технику сами строят неважную, но богаты, и легко могут покупать у соседей все самое лучшее."), new
 Array("Bionas", 99, 34, 99, 99, 99, 77, 1, 99, "13", "Tektronix", "Похоже, заповедь «плодитесь и размножайтесь» касалась именно этих гуманоидов. По мнению других рас – они плодятся как саранча. Использование слабых энергетических полей в качестве основного строительного материала позволяет им очень быстро зас" + "траивать планеты своими сооружениямию настолько же прекрасными, насколько и непрочными. Как, впрочем, и все, что они строят. Во время войн используют огромное количество дешевых юнитов."), new Array("Driads", 99, 51, 99, 69, 74, 1, 1, 99, "13", "Tektronix", "Поглощающие свет и строящие из собственных тел дриа" + "ды предпочитают долгую и неспешную жизнь, посвященную размышлениям. Их научные разработки зачастую используются вассалами, а добывающие технологии могут стать основой экономики небольшой империи. Иногда содержат свой боевой флот, но лучшей защитой являются для них верные вассалы."), new Array("Cybe" + "rs", 99, 39, 30, 99, 99, 1, 1, 99, "13", "Tektronix", "В их стальных телах течет электрический ток, и некоторые верят, что Cybers – искуственно созданная раса машин. Делиться тайной своего рождения киберы, к сожалению, не намерены. Их методики расчета двигателей – близки к идеальным, хотя машинность мышления" + " и не располагает к творчеству. Во время войн обычно используют мобильные флотские соединения, которыми легко жертвуют ради общего дела."), new Array("Blades", 1, 29, 99, 99, 99, 1, 21, 99, "13", "Tektronix", "Эти силикоиды выглядят как живая коллекция зубов и когтей и имеют сходный характер. Не менее скверны" + "м нравом отличаются выращиваемые ими живые танки. Корабли получаются похуже, за счет дорогих, слабых и непрочных двигателей, которые не являются их сильной стороной. Двигаться слишком быстро Blades считают ниже своего достоинства."), new Array("Hammers", 1, 78, 99, 1, 99, 1, 1, 99, "13", "Tektronix", "Наиболе" + "е скучная на вид раса. Хаммер выглядит как булыжник, плавающий в полупрозрачном силовом поле и напоминает яичницу. Нюанс в том, что пробить это жиденькое на вид поле вилкой весьма проблематично. Убить хаммера сложно, потому они редко торопятся с размножением. Строят весьма неплохие корпуса за срав" + "нительно небольшие средства."), new Array("Sensato", 99, 29, 99, 98, 1, 1, 1, 99, "21", "Powerman", "«Добывающий» ЕТУшник. Медленнее набирает ТУ, позже получают экономические спецдетали. Однако их качество выше, чем у Wizzard.\n\nРасы Sensato и Klug различаются исключительно положением движка живучести. Реком" + "ендуется устанавливать на минимум, что ускоряет развитие и увеличивет количество спецдеталей, хотя и уменьшает количество пригодных планет."), new Array("Klug", 99, 10, 99, 99, 1, 1, 1, 99, "21", "Sheibani-khan", "*"), new Array("Wizzard", 99, 50, 99, 1, 1, 1, 1, 99, "21", "Ценzор", "Насколько я понимаю, для максимальног" + "о ЕТУ главным фактором является произведение бонуса науки на бонус добычи. У Powerman'а этот коэффициент равен 1,654·1,631=2,6977, у Sheibani-khan'а — 1,652·1,632=2,6961. Вот у этого этот коэффициент будет равен 1,916·1,534=2,9391." + "\n\n" + "Просаженный прирост населения вкупе с узким Т-диапазоном " + "сделает очень долгим и тяжелым развитие, и также приведет к тому, что его будет неэффективно использовать в качестве простого мяса, в отличие от двух предыдущих. Но максимум указанного выше коэффициента – дает возможность достичь обьема наукокредитов на 9% выше, при прочих равных."), new Array("Gla" + "mour", 99, 50, 99, 99, 99, 99, 1, 99, "22", "Colisa Lalia", "Очень легкая в развитии раса, если у вас есть лорд, который поставляет вам мирную и военную технику. Большая добыча ресурсов позволяет содержать много импортной высокоуровневой техники, нивелируя военные и научные минусы. Наиболее выгодная раса в с" + "оставе мультокластера."), new Array("Ruvido", 99, 50, 99, 99, 99, 1, 1, 99, "22", "Colisa Lalia", "Отличная раса для одиночной игры. Более сложная в развитии, чем предыдущая, но обладающая лучшими характеристиками скорости, науки и добычи ресурсов. Способна легко достигнуть 12-14 ЕТУ и иметь приличную мирную " + "технику собственного производства."), new Array("Taupe", 99, 44, 99, 99, 99, 1, 1, 99, "22", "Амидала", "Разновидность хардкорного мяса. См. также Ruvido и Worms."), new Array("Malerba", 99, 99, 99, 99, 99, 70, 1, 99, "22", "Минька", "Расселяются где угодно (много планет +100 кредитов), быстро и дешево строят и много доб" + "ывают. Все для Лорда."), new Array("Colonizar", 1, 73, 99, 99, 99, 99, 1, 99, "22", "Powerman", "Мясо-заселялки — две таких перекрывают весть температурный диаппазон."), new Array("Vitesse", 99, 99, 1, 99, 1, 1, 1, 99, "23", "Colisa Lalia", "Раса обладает очень большим бонусом скорости, расплачиваясь за это неприятно низ" + "кой скоростью производства. Замечательная наука, радует очень высокая добыча ресурсов. Одна из самых распространенных технологичных рас в игре."), new Array("Fliegen", 99, 10, 1, 99, 1, 1, 1, 99, "23", "Nikitosina", "Массовый летун. Развивается быстрее Vitesse, производит больше двигателей. Малая прочность зд" + "есь является плюсом, так как двигатели имеют отрицательные хиты. Недостатки - чуть меньший бонус скорости и меньшее количество пригодных планет."), new Array("Ligero", 99, 50, 1, 99, 99, 99, 1, 99, "24", "Colisa Lalia", "Раса позволяет строить хорошие недорогие двигатели среднего ТУ. Очень хорошая добыча ресу" + "рсов. В любом государстве будет полезна как производитель массовой мирной техники.\n\nBarato, Ligero и Moleta — бюджетники, практически братья-близнецы. В настоящее время неактуальны. Могут иметь узкое применение как вассалы очень высокоуровневого ЕТУшника."), new Array("Pfiffig", 99, 99, 1, 99, 99, 1, 1, 99, "24", "Colisa Lalia", "Раса обладает наибольшим возможным бонусом скорости, расплачиваясь за это неприятно низкой скоростью производства и ценами. Радует очень высокая добыча ресурсов."), new Array("Barato", 99, 68, 1, 99, 99, 99, 1, 99, "24", "sfinx", "*"), new Array("Trotter", 99, 1, 1, 99, 99, 1, 1, 99, "24", "Амидала", "Является антиподом Pfiffig в плане живучести. За счет этого быстрее развивается, имеет меньшую цену и большую надежность движков, однако цена вопроса - чуть меньший бонус скорости и уменьшение числа пригодных планет."), new Array("Moleta", 99, 40, 1, 99, 99, 99, 1, 99, "24", "SashaXl", "*"), new Array("Ancient" + " Idols", 30, 70, 20, 20, 30, 10, 50, 60, "25", "GribUser", "*"), new Array("Haltbarkeit", 49, 50, 1, 1, 1, 1, 35, 99, "25", "Colisa Lalia", "Сбалансированный военник."), new Array("Террор", 1, 40, 99, 15, 1, 1, 1, 95, "25", "гуляка", "*"), new Array("Omicida", 51, 1, 99, 99, 1, 1, 99, 99, "25", "Colisa Lalia", "Раса способна производить замеча" + "тельные недорогие пушки. Принадлежность к романтикам открывает доступ к возможности постройки специалиста по простым системам наведения, которые являются неотъемлемой частью наиболее качественных высокотехнологичных юнитов."), new Array("Murderer", 1, 1, 99, 99, 1, 1, 99, 99, "25", "Colisa Lalia", "Раса спосо" + "бна производить самые лучшие пушки при относительно невысокой цене."), new Array("Krieger", 1, 99, 99, 1, 1, 1, 99, 99, "25", "Colisa Lalia & Испанец", "Раса обладает внушительными комплексными военными характеристиками за соответствующую цену. Приличная наука позволяет достигать высокого ТУ при наличии жирны" + "х вассалов."), new Array("Salvaguardia", 1, 50, 1, 1, 1, 1, 99, 99, "25", "Colisa Lalia", "Замечательная раса-производитель высокоуровневой брони и корпусов. Очень рекомендуется использование импортных пушек."), new Array("Luchador", 51, 1, 99, 99, 1, 1, 50, 99, "25", "Sheibani-khan", "Дамагер. Давняя попытка совместить " + "в одной расе науку, добычу и боевые характеристики."), new Array("Fautore", 1, 20, 99, 1, 1, 1, 99, 99, "25", "Alfa Thukcha", "Военник-универсал. В сравнении с Krieger быстрее развивается, дешевле. Ниже прочность корпусов, эффективнее защитные системы."), new Array("Coraza", 99, 23, 99, 1, 1, 43, 81, 1, "25", "Entrophy", "Одна их самых дешевых защит из предложеных. Из плюсов есть еще высокая скорость производства, неплохая невидимость, плюсовый детект. За ето приходится расплачиватся низкой скоростю добычи и очень малым разбросом температур... Как результат имеем низкую скорость развития."), new Array("Armure", 99, 10,
80, 1, 1, 25, 90, 1, "25", "Минька", "Специалист по защитным системам."), new Array("Defence", 99, 1, 55, 1, 1, 49, 99, 1, "25", "Entrophy", "Самое, возможно, экстремальное соотношение цены и Защиты. Детали будут получаться такими, что за ними очередь будет выстраиваться. Особенно если его раскачать до серьёзного ТУ (" + "бонус науки позволяет). Плюс, будет поставлять дешевых невидимок, если в кластере нет спеца-невидимки. Задача у него одна — выжить с такой добычей и таким диапазоном температур. Нереальная задача для сингла."), new Array("Humdrum", 1, 1, 1, 1, 1, 1, 99, 1, "25", "Colisa Lalia", "Защитник-зануда."), new Array("Heiter", 99, 1, 1, 1, 1, 1, 99, 1, "25", "Colisa Lalia", "Защитник-романтик."), new Array("Кровавое мясо", 1, 1, 99, 99, 99, 1, 21, 99, "26", "Tektronix", "Раса имеет определенный провал по скорости мирного производства, компенсируемый высоким приростом. Другим минусом является довольно узкий температурный диапазон." + "\n\n" + "Зато раса вполне сможет выжить и успешно противостоять агрессору при перекрытии каналов доставки импортной техники."), new Array("Pavois", 99, 30, 1, 1, 50, 70, 99, 1, "26", "Stavros", "Добыча отвратная, цены в плюсе, диапазон узкий – но таможню построить реально." + "\n\n" + "Если его высаживать в разведа" + "нный район – вполне жизнеспособен и полезен в качестве производителя комплектующих, ИМХО." + "\n\n" + "Хотя у игроков, не имеющих опыта выращивания спец.рас могут возникнуть проблемы." + "\n\n" + "Это, вообщем-то вариант Armure (Автор Минька ), но диапазон шире на 3 градуса, скорость в плюсах, а прирост и" + " невидимость лучше на 21% за счет удорожания на 8%, ухудшения добычи еще на 4 % и науки чуть лучше чем у Греерсов. ИМХО тут наука не нужна – завассалить ЕТУшником, а ресурсами подкармливать через таможню по мере надобности."), new Array("Sacaborrachos", 1, 1, 99, 99, 1, 99, 99, 99, "26", "Colisa Lalia", "Дама" + "гер."), new Array("Gros", 1, 99, 1, 1, 99, 1, 99, 99, "26", "Colisa Lalia", "Специалист по производству мощных корпусов и брони среднего уровня. Очень интересен как производитель шасси, имеющих низкую поддержку по вторичке (штурмовики, танки, сторожевики). Использовать нестандартным образом."), new Array("Tepp" + "ista", 1, 2, 99, 99, 1, 61, 89, 99, "26", "sfinx", "Бюджетник."), new Array("Ogro", 1, 30, 99, 1, 1, 99, 99, 99, "26", "Бобби Сендс", "Бюджетник."), new Array("Rowdy", 20, 25, 99, 88, 80, 82, 85, 99, "26", "Entrophy", "Бюджетник."), new Array("Manirroto", 2, 99, 35, 1, 90, 1, 99, 99, "26", "SferagadXII", "Достаточно дорогой хитовик с серьезным" + " провалом по науке. Очень напоминает Gros. Может применяться как сборщик бакенов."), new Array("Stark", 1, 1, 1, 1, 99, 1, 99, 99, "26", "Alfa Thukcha", "Типа — сила есть, ума не надо."), new Array("Gioioso", 1, 65, 50, 10, 99, 99, 1, 99, "26", "Минька", "Задача — получение как можно более дешёвой прочности для изготовле" + "ния прочных корпусов транспортов малого ТУ (все знают, что чем меньшего ТУ корпус применён, тем легче и лучше, но у собственных корпусов не всегда хватает хитов)." + "\n\n" + "Естественно,что прочность 132 таким путём не достичь."), new Array("Escuchar", 1, 50, 1, 1, 1, 1, 1, 1, "27", "Colisa Lalia", "Наилучший с" + "пециалист-детекторщик. Сочетание низкой добычи, низкого прироста и узкого диапазона делает одиночное развитие такой расы чрезвычайно сложным."), new Array("Guigner", 1, 1, 99, 38, 60, 1, 1, 1, "28", "sfinx", "Бюджетник."), new Array("Cache-cache", 99, 99, 1, 1, 1, 65, 33, 1, "29", "Минька", "Невидимость 60 – это в полтор" + "а раза меньше чем максимальная 96, но бонус к науке 50% и пара-тройка хороших вассалов позволят данной расе производить высокоуровневые системы невидимости, многократно превосходящие по свойствам системы невидимости 12-15 ТУ. Кроме того, вожделенный бонус по ценам -12,8% позволит использовать неви" + "димость поистине во вселенских масштабах." + "\n\n" + "Раса сложна в развитии, так как имеет сильный пенальти (не такой ужасающий, как у невидимки-вассала, но существенный) по добыче ресурсов (лечится,как обычно,вассалами, но до них ещё дорасти нужно)." + "\n\n" + "Ещё из плюсов – неприхотливость по темпе" + "ратурному диапазону (треть планет вселенно подходит для заселения идеально), приятный бонус по полётам и весомый бонус по детекту (некоторые системы невидимости дополнительно обладают возможностью детекта, бонус детекта сделает применение деталей от данного спеца ещё желанней)."), new Array("Calma",
99, 99, 1, 99, 1, 99, 99, 1, "2A", "Ичиндар & Colisa Lalia", "Наилучший специалист-невидимка."), new Array("Pellucid", 99, 99, 97, 95, 12, 99, 39, 1, "2A", "Entrophy", "Несмотря на некоторый выигрыш в ценах по сравнению с хардкорным невидимщиком, добыче и скорости производства, малополезен в практическом применении."), new
 Array("Детектор-невидимка", 1, 99, 1, 1, 1, 99, 37, 1, "2B", "Молодой", "Плюсы: хороший детект, невидимость и отличный диапазон температур. Нет пенальти по науке и ценам, приемлемая скорость." + "\n\n" + "Минусы: отвратительная добыча.Итог: Отличный вассал ЕТУшника, сам содержать развед флот не может, но снабжает" + " других разведчиками."), new Array("Десантник", 99, 99, 99, 99, 99, 99, 1, 99, "30", "Kosta", ""), new Array("Интендант", 99, 5, 99, 99, 99, 1, 1, 99, "30", "Kosta", ""), new Array("Пионер", 99, 50, 99, 99, 99, 50, 1, 99, "30", "Kosta", ""), new Array("Лидер", 99, 45, 99, 1, 1, 1, 1, 99, "30", "Kosta", ""), new Array("Разведчик", 99, 99, 1, 99, 1, 99, 99, 1, "30", "Kosta", ""), new Array("Контрразведчик", 1, 35, 99, 1, 1, 1, 1, 1, "30", "Kosta", ""), new Array("Стандартный двигателист", 99, 1, 1, 99, 99, 71, 1, 99, "30", "Kosta", ""), new Array("Усиленный двигателист", 99, 5, 1, 99, 99, 1, 1, 99, "30", "Kosta", ""), new Array("Странник", 99, 66, 1, 99, 99, 99, 1, 99, "30", "Kosta", ""), new Array("С" + "тандартный оружейник", 1, 1, 99, 99, 1, 75, 99, 99, "30", "Kosta", ""), new Array("Усиленный оружейник", 1, 1, 99, 99, 1, 50, 99, 99, "30", "Kosta", ""), new Array("Стандартный промышленник", 1, 39, 77, 1, 99, 99, 1, 99, "30", "Kosta", ""), new Array("Военный промышленник", 1, 72, 1, 1, 99, 99, 1, 99, "30", "Kosta", ""), new Array("Защитник A", 99, 45, 1, 1, 1, 1, 99, 1, "30", "Kosta", ""), new Array("Защитник B", 1, 35, 1, 1, 1, 1, 99, 1, "30", "Kosta", ""), new Array("Trekkers", 99, 99, 21, 61, 99, 91, 1, 99, "40", "Tektronix", "Треккерсы склонны к путешествиям. Летают быстро, к переменам климата относятся спокойно. Наука слабая, сидеть над кульманом и что-то разрабатыват" + "ь для треккерса смерти подобно. С удовольствием дорабатывают до своих стандартов двигатели рас с более высоким техническим уровнем. Сами нападают редко, но если приходится воевать – излюбленная тактика – изматывание противника бегом. Имеют на удивление неплохую добычу ресурсов, потому что они треб" + "уются для полетов. Соседи ценят треккерсов и покупают их недорогие и эффективные двигатели."), new Array("Wrung Humans", 99, 44, 59, 36, 99, 18, 64, 58, "40", "Tektronix", "Очередная мутация расы, наиболее склонной к самоуничтожению. Эти хилые и болезненные существа – ужас вселенной. Им подходят немногие план" + "еты, поэтому за подходящие бьются насмерть. Быстро строят военную технику со средними боевыми показателями, но большой маневренностью, что позволяет ей избегать попаданий противника. Одна из рас, нестойких к вирусу «крейзи», заставляющему нападать на соседей без видимых причин. Вследствие этого со" + "седи относятся к хумансам с подозрением, но народ, поборовший эту заразу, может достичь лидерства в любом государстве."), new Array("Eggheads", 99, 44, 99, 60, 16, 34, 1, 99, "40", "Tektronix", "Яйцеголовые ценят три занятия. Работать в научных центрах, строить научные центры, добывать ресурсы для постройки н" + "аучных центров. Все остальное считают пустой тратой времени. Наиболее быстро двигают науку, но невнимание к мелочам не лучшим образом сказывается на качестве продукции. Впрочем, с удовольствием передают свои разработки вассалам, для дальнейшего усовершенствования. Воевать не умеют в связи с тем, ч" + "то от этого непродуктивного занятия их всегда освобождают вассалы."), new Array("Concretes", 1, 60, 61, 26, 99, 51, 25, 99, "40", "Tektronix", "Одни из самых основательных существ во Вселенной. Если уж что-то строят, то на века. Разрушить построенное конкретами – тяжелая задача даже для них самих, несмотря на" + " то, что средства разрушения им тоже неплохо удаются. Трудолюбивы, платят неплохие налоги. Военные флоты строить не любят, но тому, кто их заставил это делать – не поздоровится. К великому сожалению остальных рас – тоже склонны к заражению «крейзи»."), new Array("Warriors", 1, 52, 99, 61, 99, 39, 61, 99, "40", "Tektronix", "Вэрриоры – наиболее агрессивная раса. Вся их жизнь – служение войне. Как ни странно, имеют неплохую экономику, естественно, поставленную на военные рельсы. «Крейзи» даже не считают заболеванием. Тем не менее, зачастую живут в мире с соседями, обеспечивая их обороной взамен на ресурсы " + "или технологии. Существенным недостатком их военной доктрины является прямолинейность – пришел, увидел, победил. Совершенно не умеют осуществлять как диверсионные, так и антидиверсионные действия."), new Array("Shadows", 99, 69, 99, 99, 1, 99, 42, 1, "40", "Tektronix", "Если у вас нет паранойи – это не значит" + ", что за вами не следят. А если рядом с вами живут шады – то лучше уж быть параноиком. Они почти ничего не умеют делать хорошо. Они не умеют работать, мощность их пушек не выдерживает критики, их корабли рассыпаются в пыль от малейшего удара. Но чтобы этот удар нанести, вначале найдите их корабль." + " Системы невидимости шадов вряд ли позволят вам это сделать. А если учесть их быстрое размножение, приспособляемость к любому климату и дешевую, но эффективную разведку – то пока соседи немного разовьются, над каждой их планетой уже может висеть невидимый транспорт с пехотой."), new Array("Paranoia" + "cs", 1, 53, 99, 51, 82, 37, 1, 19, "40", "Tektronix", "Самоназвание этой расы неизвестно, скрывают. Лозунг параноиков – «Предупрежден, значит вооружен». Весь их фольклор пронизан идеей чужих, скрытно проникающих на их планеты. Поэтому каждый параноик должен построить радар, посадить дерево и воспитать сына. " + "Второе и третье – необязательно. Соседи относятся к параноикам с юмором, помогают ресурсами, привезенными ВИДИМЫМ транспортом, с удовольствием покупают наиболее массовые изделия их промышленности. Системы обнаружения, естественно.")];

document.popbody.onkeydown=function keydown(event){
     //console.log(event.keyCode);
     if (event.keyCode==46) { // DEL
          var selection=raceslisttable.getSelection();
          var temparray=[];
          var options={allowHtml: true, showRowNumber: false};
          for (var i = 0; i < selection.length; i++) {
               temparray.push(selection[i].row);
          };
          if (raceslisttable.getSortInfo().sortedIndexes)  {// в таблице применена сортировка ?
               options.sortColumn=raceslisttable.getSortInfo().column;
               options.sortAscending=raceslisttable.getSortInfo().ascending;

               //for (var i = 0; i < temparray.length; i++) {temparray[i]=raceslisttable.getSortInfo().sortedIndexes[temparray[i]];}
          }
          temparray.sort().reverse();   // убираем строки снизу вверх чтоб не менялись их номераж
          for (var i = 0; i < temparray.length; i++) {
               console.log(temparray[i]);
               dataraceslist.removeRow(temparray[i]);
          };          
          raceslisttable.setSelection([]);
          raceslisttable.draw(dataraceslist,options);          
     }

     if (event.keyCode==84) { // "t"
          setsliders([95,1,50,8,98,8,50,50]);addtotable(); 
          setsliders([87,13,50,11,93,15,50,50]);addtotable(); 
          setsliders([82,24,50,12,86,16,50,50]);addtotable(); 
          setsliders([80,33,50,15,84,17,50,50]);addtotable(); 
          setsliders([71,41,50,16,83,18,50,50]);addtotable(); 
          setsliders([71,48,50,18,81,20,50,50]);addtotable(); 
          setsliders([70,54,18,20,80,22,90,50]);addtotable();
          setsliders([73,55,18,32,82,23,99,50]);addtotable(); 
          setsliders([76,61,18,32,81,24,99,50]);addtotable(); 
          setsliders([50,50,50,50,50,50,50,50]);addtotable();      
     }

     if (event.keyCode==65){
          var temparray=[];
          for (var i=0;i<8;i++) temparray.push(globalvars["primslider"+i].value);
          console.log("setsliders(["+temparray+"]);addtotable();")

     }
     if (event.keyCode==69){ // "e" 
          exportrace();
     }

     if (event.keyCode==82){ // "r" 
          registerrace();
     }

}

function Gradient(data,targetfunction){
     var i;     
     var curValue=targetfunction(data);     
     var curData=[];
     var tempdat;
     var flag;
     //var NewData=[];
     function testnewvalue(){
          var newval=targetfunction(curData);
          if (newval>curValue) {
               data=curData.slice();
               curValue=newval;
               flag=true;
          }
     }

     do {
          flag=false;          
          for (var i = 0; i > data.length ; i++) {
               tempdat=data[i];
               curData[i]=tempdat+1;
               if (curData[i]<50) testnewvalue();               
               curData[i]=tempdat-1;
               if (curData>-50) testnewvalue();                
          };

     } while (flag);
     return curData;  
}

function registerrace(){
// http://www.the-game.ru/makenewrace/?capcode=&capachamd5=blabla&race-nature=o&industry-nature=o&race-name=ttt&t-optimal=35&zanud=10&spec=61&nomads=1&longlife=1&intell=1&old=99&traiders=99&small=1
	var inputsname=['race-name','race-nature','industry-nature','t-optimal','zanud','spec','nomads','longlife','intell','old','traiders','small'];
	var inputslabels=['Имя расы','Природа расы','Основа производства','Комфортная температура'];
       	var inputssuffix =[/* '<span style="color:red;">English-only,</span> иначе будут кракозябры'*/ '','','','°C'];

	var popupWin = window.open(null,"Register","");    
	var popbody = popupWin.document.popbody;
	popbody.innerHTML = '';
	var titl=popupWin.document.createElement('title');
	titl.innerHTML = 'Экспорт'
	popupWin.document.head.innerHTML='<meta http-equiv="Content-Type" content="text/html; charset=utf-8">';
	popupWin.document.head.appendChild(titl);
             

	var form=popupWin.document.createElement('form');
	form.action='http://www.the-game.ru/createrace/';
        form.setAttribute('accept-charset','UTF-8');
	var exportspan=popupWin.document.createElement('span');
        exportspan.innerHTML="Пройдите первую страницу регистрации в этом же браузере, затем введите имя расы, и нажмите отправить.";
        popbody.appendChild(exportspan);
	popbody.appendChild(form);
	var tabl=popupWin.document.createElement('table');
	form.appendChild(tabl); 
	var inp,tr,td1,td2;
	for (var i = 0; i < inputsname.length; i++) {
		tr= popupWin.document.createElement('tr');		
                td1= popupWin.document.createElement('td');		
                td2= popupWin.document.createElement('td');		
                td3= popupWin.document.createElement('td');

                td1.innerHTML=inputslabels[i]||primlabels[2*i-8]+' - '+primlabels[2*i-7];
		td3.innerHTML=inputssuffix[i]||'';
        	inp = popupWin.document.createElement((i==1||i==2)?'select':'input');
		if (i==1||i==2) {
			inp.innerHTML='<option value="o">Органика</option><option value="e">Энергия</option><option value="m">Минералы</option></option>';
			inp.value=globalvars["primslider8"].value.charAt(i-1);
			for (var z = 0; z < 3; z++){if (inp[z].value!=inp.value) inp[z].disabled=true}; 
		}		
        	inp.name=inputsname[i];
		if (i>3) { 
			inp.value= /* 100- */ globalvars["primslider"+(i-4)].value;	
			inp.setAttribute('readonly','');
			}
		if (i==3) { 
			inp.value=globalvars["primslider9"].value;
			inp.setAttribute('readonly','')
			}
        	td2.appendChild(inp);		
		tr.appendChild(td1);		
		tr.appendChild(td2);
		tr.appendChild(td3);			
	        tabl.appendChild(tr);		
        	}
	var sb= popupWin.document.createElement('input');		
	sb.type='submit';
	form.appendChild(sb); 


}

function exportrace(){     
     
     var ta=[];
     var i;
     var sp;
     
     var popupWin = window.open('',"Export","menubar=no,toolbar=no,location=no,status=no,resizable=yes,left=100,top=100,width=500,height=500");
     popupWin.onload = () => {    
          var popbody = popupWin.document.body;
          popbody.innerHTML = '';
          var titl=popupWin.document.createElement('title');
          titl.innerHTML = 'Экспорт'
          popupWin.document.head.appendChild(titl);
          var spans=['Текущая раса:','Таблица сравнения:']

          for (var i = 0; i < 2; i++) {
               ta[i] = popupWin.document.createElement('textarea');
               ta[i].style.width='100%';
               ta[i].style.height='45%';

               sp = popupWin.document.createElement('span');
               sp.innerHTML=spans[i];
               popbody.appendChild(sp);
               popbody.appendChild(ta[i]);
               //console.log(ta[i]);
          };

          var params=[];
          var s='';
          for (var i=0;i<10;i++) params.push(globalvars["primslider"+i].value);
          if (parsehash().calcmode=='nl') {          
               s = calcconst.nlmode ? 'NL: ' : '';          
          }


          var currentRaceName=s+params.join(',');
          var currentRaceBehavior=globalvars["racetitle"].innerHTML;
          var settings=[null,true,false];

          
          var x = "[" + "spoiler=" + currentRaceName + "]" + "\n" + "[" + "style=color:6cf" + "]" + currentRaceBehavior + "[" + "/styl" + "e" + "]" + "\n";
               x += "[" + "pre" + "]";
               for (var p = 0; p < 8; p++) x += (50 == params[p]) ? ("[" + "style=color:fc6" + "]" + params[p] + "[" + "/style" + "]" + " ") : ((1 > params[p] || 99 < params[p]) ? ("[" + "style=color:f66" + "]" + params[p] + "[" + "/style" + "]" + " ") : (params[p] + " "));
               x += "[" + "/pre" + "]" + "\n";
               x += "[" + "table" + "]" + " border:none\n";
               var koler = (1 == settings[0]) ? ("393") : ((3 == settings[0]) ? ("39c") : ("3c9"));
               for (var c = 0; c < 13; c++) {
                    var color = (settings[2] && "" != colors[c]) ? (";color:" + colors[c].charAt(1) + colors[c].charAt(3) + colors[c].charAt(5)) : ("");
                    var addon = (settings[3] && "" != weights[c] && 0 != weights[c]) ? ("||style=border:n" + "one;width:20;font-size:65%;text-align:right;color:" + koler + "|" + weights[c]) : ("");
                    x += "|style=border:none|" + seclabels[c] + "||style=border:none;text-align:right" + color + "|" +((c==0)?(globalvars["primslider9"].value+'±'):(''))+ datasecpar.getFormattedValue(c, 2) + "\n|-\n"
               };
               x += "[" + "/table" + "]\n";
               var link = getlink();
               link.url = "https://jlblc.droppages.com/dc/new/race"+link.href;
               x += "[url=" + link.url + "]"+link.url+"[/url]";
               x += "[" + "/spoiler" + "]";

          ta[0].innerHTML=x;

          var rows=[];
          var rowsparam=[];
          var temparray=[];
          var matches;
          var regexp = /href="?([^"\s]+)["\s][^>]*>([^<]+)</;

          var i,j;
          
          for (j = 0; j < dataraceslist.getNumberOfColumns() ; j++) {
               temparray.push(dataraceslist.getColumnLabel(j));
          }
          rows.push(temparray);
          temparray=[];

          for (i = 0; i < dataraceslist.getNumberOfRows() ; i++) {                    
               for (j = 0; j < dataraceslist.getNumberOfColumns() ; j++) {
                    temparray[j]=dataraceslist.getFormattedValue(i,j);

                    if ( matches = temparray[j].match(regexp) ) {                    
                         temparray[j]="[url=https://jlblc.droppages.com/dc/new/race"+matches[1]+"]"+matches[2]+"[/url]";
                    }
               }
               rows.push(temparray);
               temparray=[];
          }
          rows.style="font-family: 'lucida grande', tahoma, verdana, arial, sans-serif; font-size: 14px;";
          //console.table(rows);
          ta[1].innerHTML=createbbtable(rows);

          popupWin.focus();
     }


}

function createbbtable(rows,params){
     var s='';
     var par;
     var apar=['style','rowspan','colspan'];
     rows.style = rows.style || '';
     for (var i = 0; i < rows.length ; i++) {
          for (var j = 0; j < rows[i].length ; j++) {
               par='';
               if (params) {
                         for (var k = 0; k <3; k++) {
                              par += params[i][j][apar[k]] ?  apar[k]+'="'+params[i][j][apar[k]]+'" ' : '';
                         }
                    if (par) par += '|';
               }                         
               s += '\n|' + par + rows[i][j];

          }
          s += '\n|-';
     };
     return '[table]'+rows.style+s+'[/table]';   
}

function slideronkeypress(event){
      //console.log(event.keyCode,' ',event.charCode);
     if (event.charCode=="+".charCodeAt(0)) { 
          document.activeElement.value++;
          document.activeElement.onchange();
          }
     if (event.charCode=="-".charCodeAt(0)) { 
          document.activeElement.value--;
          document.activeElement.onchange();
     } 

}

function em(x) {
                return (document.getElementById(x))
            }

function showHide(n) {
                var image = em("_" + n);
                var block = em(n);
                if ("block" == block.style.display) {
                    block.style.display = "none";
                    image.innerHTML = "►"
                } else {
                    block.style.display = "block";
                    image.innerHTML = "▼";
                }
            }
	  

// ------------------------------------------------------------------------------------------------------------------------------------------

calcconst.abac=theAbacus;
//if (parsehash().secretparam=='new') {calcconst.abac=newAbacus};
//if (parsehash().calcmode=='nl') {calcconst.abac=nlAbacus};
calcconst.seclabels=seclabels;
if (parsehash().secretparam=='new') {calcconst.seclabels=newseclabels};

var varnames=parsehash().secretparam=='new'?['tmp','grw','fsp','fds','dfn','prc','scn','pcf','war','hp','las','rok','mnp','mns','mnc','vc','vs','stl','dtc']:['t','p','f','d','c','i','b1','b2','h','a','m','s1','s2'];
var formulas=parsehash().secretparam=='new'?['новый ЕТУ','mnc*scn','Наукокредиты','mnc*vc','скорость ст.зонда','fsp*6/pow(15+4,0.66)','дальность ст.зонда','fds*1.3*pow(30,0.49*2)/pow(15+4,0.49)']:['ЕТУ','i*m','скорость ст.зонда','f*6/pow(15+4,0.66)','дальность ст.зонда','f*1.3*pow(30,0.49*2)/pow(15+4,0.49)'];

calcconst.minpar=[];
calcconst.maxpar=[];

 for (var i=0; i<calcconst.abac.length; i++) 
     { calcconst.maxpar[i]=0;
      for (var j=0; j<calcconst.abac[0].length; j++) 		
        { calcconst.maxpar[i]+=Math.abs(calcconst.abac[i][j]);	 
		};
		calcconst.maxpar[i]*=49;
	   calcconst.minpar[i]=Math.abs(calcneg(-calcconst.maxpar[i],(i!=0)));
	  }
     
     

function calcmaxmin(){    

     console.time("calcmaxmin");
     calcconst.nl={};
     calcconst.nl.minpar=[];
     calcconst.nl.maxpar=[];
     calcconst.nl.valueformin=[]; while(calcconst.nl.valueformin.push([]) < 13);
     calcconst.nl.valueformax=[]; while(calcconst.nl.valueformax.push([]) < 13);
     var x;
     var temparray=[0];
     for (var i=-49; i<50; i++) { temparray.push(i) };
     for (var i=0; i<nlAbacus.length; i++) 
     { 
        calcconst.nl.maxpar[i]=-0;calcconst.nl.minpar[i]=0;        
        for (var j=0; j<nlAbacus[0].length; j++)          
          {
               var  it,imax=-999 , imin=999, indxmin,indxmax;
               for (var z= 0; z<temparray.length; z++) {
                    x=temparray[z];     
                    //if(j==3) {console.log(x);}
                    with (Math) with (x) it=+eval(nlAbacus[i][j]);
                    if  (it>imax) {imax=it;indxmin=x+50};
                    if  (it<imin) {imin=it;indxmax=x+50};
               }
          calcconst.nl.maxpar[i]+=imax;
          calcconst.nl.minpar[i]+=imin;
          calcconst.nl.valueformin[i][j]=indxmin;
          calcconst.nl.valueformax[i][j]=indxmax;        
               
          }
     calcconst.nl.minpar[i]=Math.abs(calcneg(calcconst.nl.minpar[i],(i!=0)));
          //console.log(i,j,indxmin,indxmax)
          
     //sectable.da.rows[i+1].cells[3].innerHTML='<i>'+formatpar(-calcconst.nl.minpar[i],i)+'</i>';
     //sectable.da.rows[i+1].cells[4].innerHTML='<i>'+formatpar(calcconst.nl.maxpar[i],i)+'</i>';

     }
     console.timeEnd("calcmaxmin");
     calculate();

}
  
function calcneg(val,notemp){
	return (val<0)?((notemp)?(100*val)/(100-val):(200*val)/(200-val)):val;
}
function formatpar(par,notemp){
	return notemp?Math.round(10*par)/10+'%':Math.round(100 * 10 * (1 + par/100)) / 100 + "°";
}

function cutword(text){
     var ta=text.split(/\s/);
     var result='';
     for (var i=0;i<ta.length;i++) {
     //console.log(ta[i]);
     if (ta[i].length<7) result+=ta[i]
         else {
		        for(var j=3;j<ta[i].length-1;j++) if ('бвгджзклмнпрстфхцчшщ'.search(ta[i].charAt(j))!=-1) break;
				result+=ta[i].substring(0,j+1)+'.';
		      }
	result+=' ';
     }
     //console.log(result);
     return result.replace(/\s+$/, '');
}


// Events
function nltrigger(){     
     calcconst.nlmode=globalvars['nlcheckbox'].checked;     
     calculate();     
}

function parameditevent(){
     sectable.rz.rows[13].cells[2].innerHTML="<input type=button value=расчет onclick='reversecalc()'>"
}

function reversecalc(){
     var secondparam=[];
     
     for (var i=1; i<14; i++) {
          secondparam[i-1]=parseFloat(sectable.rz.rows[i].cells[1].getElementsByTagName('span')[0].innerHTML);
          }
     console.log('reversecalc : ',secondparam);
     var targetfunction=function(data){


     };



}

function setsliders(a){
     var defaultv=[50,50,50,50,50,50,50,50,'___',50];
     for (var i=0;i<10;i++) globalvars["primnumber"+i].value=globalvars["primslider"+i].value=a[i]||defaultv[i];
     calculate();
}

function clicktorow(e,a,nl){
     console.log(e);
     if (nl!=undefined) { globalvars['nlcheckbox'].checked=nl; nltrigger(); }
     setsliders(a);
     e.preventDefault();
    // return false;
}

function getlink(){
     var s='';
     var b = [];
     var t='';
     var c='';
      for (var i=0;i<10;i++) b.push(+globalvars["primslider"+i].value||"'"+globalvars["primslider"+i].value+"'");
     if (parsehash().calcmode=='nl') {          
          s = calcconst.nlmode ? 'NL:&nbsp;' : '';
          t = calcconst.nlmode ? ',true' : ',false';
          c = calcconst.nlmode ? 'calcmode=nl&' : '';
     }
     var p=b.join(',');     
     return { "href":'#'+c+'sliders='+p , "onclick" : 'clicktorow(event,['+p+']'+t+')' , "innerHTML" : s+p };
}

function addtotable() {
     var a = [];        
     
     // dataraceslist.addRow();
     // var NumberOfRows = dataraceslist.getNumberOfRows();
     // //console.log(NumberOfRows);
     // for (var i = 0; i < calcconst.seclabels.length; i++) {
     //      dataraceslist.setCell(NumberOfRows - 1, i, datasecpar.getValue(i, 2), datasecpar.getFormattedValue(i, 2));
     // }
     for (var i = 0; i < calcconst.seclabels.length; i++) a.push({v:datasecpar.getValue(i, 2),f: datasecpar.getFormattedValue(i, 2)});
     var link=getlink();
     a.push('<a href="'+link.href+'" onClick='+link.onclick+'>'+link.innerHTML+'</a>');
     dataraceslist.addRow(a);
     raceslisttable.draw(dataraceslist, {allowHtml: true, showRowNumber: false});
}

function ondblclick1(event) {
     //console.log(event.target.cellIndex,' ',event.target.parentElement.rowIndex);

     if (event.target.cellIndex == 3 || event.target.cellIndex == 4) {
          var n = event.target.parentElement.rowIndex - 1;
          var paramsign = event.target.cellIndex - 3.5;
          paramsign = paramsign / Math.abs(paramsign);
          //console.log(paramsign);
          var par = [];
          for (var i = 0; i < calcconst.abac[0].length; i++) {
               if (calcconst.nlmode) {
                    par[i] = (paramsign > 0) ? calcconst.nl.valueformin[n][i] : calcconst.nl.valueformax[n][i];
               } else {
                    if (calcconst.abac[n][i] == 0) par[i] = 50
                    else par[i] = (calcconst.abac[n][i] * paramsign > 0) ? 99 : 1;
               }
          }
          setsliders(par);
     }
}

function ondblclick2(event){
}


function calcsecpar(){
}

function calconepar(i,par,clconst) {
     var res=0;
     for (var j = 0; j < clconst.abac[0].length; j++) {
          var x = par[j];
          if (clconst.nlmode) {
               //with(Math) with(x) res += +eval(nlAbacus[i][j]);
                res += Math.tanh(0.04 * x / (Math.abs(clconst.abac[i][j])||1) ) * 51 * clconst.abac[i][j];
          } else {
		res += x * clconst.abac[i][j]; // нормальный расчет
		
          }
     }
     return res;
}




function calculate(){

var par;
var race1={};
var normpars=[];
var t = calcconst.nlmode ? calcconst.nl : calcconst;
var primsliders=[]

for (var i=0; i<calcconst.abac[0].length; i++) {
     primsliders[i]=(globalvars["primslider" + i].value - 50);
}

var prir=globalvars["primslider8"].value.charAt(0);
var perv=globalvars["primslider8"].value.charAt(1);
var temper=globalvars["primslider9"].value;
var temper1=100-temper;
    
for (var i=0; i<calcconst.abac.length; i++) {
	par=calconepar(i,primsliders,calcconst);

	if (i==2 &&  prir=='o') par-=5;
        if (i==2 &&  perv=='o') par+=5;
	if (i==9 &&  prir=='e') par-=5;
	if (i==9 &&  perv=='e') par+=5;
	if (i==8 &&  prir=='m') par-=5;
	if (i==8 &&  perv=='m') par+=5;
	if (i==5 &&  prir!='_') par+=temper1*temper1*temper1/100000-4;
	if (i==10 &&  prir!='_') par+=temper*temper*temper/100000-4; 

//        $RaceParams{'bonus-iq'} = $RaceParams{'bonus-iq'} + $to1*$to1*$to1/100000 -4;
//	$RaceParams{'bonus-mining'} = $RaceParams{'bonus-mining'} + $to*$to*$to/100000 - 4;
//			'<option value="oem">ОEM (-5% Полет, +5% Повреждения)</option>'+
//			'<option value="ome">OME (-5% Полет, +5% Прочность)</option>'+
//			'<option value="eom">EOM (-5% Повреждения, +5% Полет)</option>'+
//			'<option value="emo">EMO (-5% Повреждения, +5% Прочность)</option>'+
//			'<option value="moe">MOE (-5% Прочность, +5% Полет)</option>'+
//			'<option value="meo">MEO (-5% Прочность, +5% Повреждения)</option>');
        


     par=calcneg(par,(i!=0));
     race1[varnames[i]]=par/100+1;
     
     //console.log(i,par);
     var normpar=(par<0) ? par/t.minpar[i] : par/t.maxpar[i];
     normpars.push(normpar);
	 datasecpar.setCell(i,3,normpar); 
	 datasecpar.setCell(i,2,par,formatpar(par,(i!=0)));
      datasecpar.setCell(i,4,formatpar(-t.minpar[i],i!=0));
      datasecpar.setCell(i,5,formatpar(t.maxpar[i],i!=0));
     
     
    }

    normpars.push(race1["i"]*race1["m"]*race1["i"]*race1["m"]/(2.75*2.75)); // ЕТУ
    //console.log(normpars);

	barformatter.format(datasecpar, 3); // Apply formatter to column
     editformatter.format(datasecpar,[2]);
	
	sectable.draw(view, {allowHtml: true, showRowNumber: false, sort:'disable'});
	document.querySelector("#divsecpar table").ondblclick=ondblclick1;
	for (var cycle_unique=1; cycle_unique<terttable.rows.length;cycle_unique++)
	  {  
	      with (Math) with (race1) terttable.rows[cycle_unique].cells[2].innerHTML=(+eval(terttable.rows[cycle_unique].cells[3].innerHTML)).toPrecision(3);
	  }

	globalvars['racetitle'].innerHTML=calculateBehaviour();  

	function calculateBehaviour() { // from Шамбобукли by Lord Locus (http://sector650-1300.narod.ru/)
     var theCharas = ["","","летун","защитник", "ценовик", "научник","","","прочнист", "дамагер", "мясо", "невидимщик","детектор","ЕТУшник"];
	var title = "";
	var power = "";
	var normpar;
	for (var c = 0; c < 14; c++) if ("" != theCharas[c]) {
		normpar= (c==4) ? -normpars[c] : normpars[c];
		if (normpar >= 0.5) {
			if (normpar < 0.785) power = "слабый ";
			else if (normpar >= 0.995) power = "хардкорный ";
			else power = "";
			if (10 == c && power != "") power = power.substr(0, power.length - 3) + "ое ";
			title += power + theCharas[c] + ", "
		}
	};
	if ("" != title) title = title.substr(0, 1).toUpperCase() + title.substr(1, title.length - 3);
	else title = "Апстенный себяубийца";
	return (title)
	}

}


function main(){
	// Убиваем внедренный гугловский table.css
	var arr=document.head.getElementsByTagName('link');
	for(var i=0; i<arr.length; i++) if (/google.*css$/i.test(arr[i].href)) arr[i].parentNode.removeChild(arr[i]);

     //console.log('main');
     // таблица вторичных параметров
    datasecpar = new google.visualization.DataTable();
	
	datasecpar.addColumn('number', '№');	// 0
	datasecpar.addColumn('string', 'Параметр');	// 1
	datasecpar.addColumn('number', 'Зн.'); // 2
	datasecpar.addColumn('number', 'Столбик');  // 3
	datasecpar.addColumn('string', 'min');      // 4
	datasecpar.addColumn('string', 'max');      // 5 
	datasecpar.addColumn('string', 'varname');  // 6 
	
	datasecpar.addRows(calcconst.seclabels.length);
	
	for (var i=0; i<calcconst.seclabels.length; i++) 
	      {   datasecpar.setCell(i,0,i);
		     datasecpar.setCell(i,1,calcconst.seclabels[i])
			datasecpar.setCell(i,4,formatpar(-calcconst.minpar[i],i!=0));
			datasecpar.setCell(i,5,formatpar(calcconst.maxpar[i],i!=0));
			datasecpar.setCell(i,6,varnames[i]);
		  };
     barformatter  = new google.visualization.TableBarFormat({width: 80, showValue:false, max:1, min:-1,drawZeroLine:false});
     titlformatter = new google.visualization.PatternFormat('<span title={1}>{0}</span>');
     editformatter = new google.visualization.PatternFormat('{0}');
     view = new google.visualization.DataView(datasecpar);
     view.setColumns([1,2,3,4,5]); // Create a view 
     titlformatter.format(datasecpar,[1,6]);
     //editformatter.format(datasecpar, [2],2);
     //barformatter.format(datasecpar, 3); // Apply formatter to column
	
    
	// таблица списка рас 
	dataraceslist = new google.visualization.DataTable();
     //dataraceslist.addColumn('string','метка');
	for (var i=0; i<calcconst.seclabels.length; i++) dataraceslist.addColumn('number',cutword(calcconst.seclabels[i]));
	dataraceslist.addColumn('string','ссылка');
	
	
var popbody=document.getElementsByTagName('popbody')[0];

$e('div',popbody,null,{id:"helpdiv"},'<div id="helpico">?</div>Можно получить расу с предельными значеними параметров совершив двойной клик на значениях в min,max столбцах.<br>В нижней таблице сравнения работает сортировка, кликайте по ячейкам шапки.<br> Экспорт по клавише e.<br>Можно удалять строки выделив их и нажав Del<br>Названия переменных для формул см. во всплывающей подсказке к ячейкам в столбике "Параметр"<br><br>');


var div1=$e('div',popbody,'row show-grid');
var div2=$e('div',div1,'span6');

var div3=$e('div',div1,'span11 offset1',{id:'divsecpar'});
var div4=$e('div',div1,'span6');
	
var div5=$e('div',popbody,'row show-grid');	
        $e('div',div5,'span1');	 
var div6=$e('div',div5,'row');	
		$e('div',div5,'span1');	 	

sectable = new google.visualization.Table(div3);
raceslisttable = new google.visualization.Table(div6);
raceslisttable.draw(dataraceslist,{allowHtml: true, showRowNumber: false,sort:'enable'});

//var f1 = $e('form',div2);
var t1= $e('table',div2,'condensed-table');
var tb1=$e('tbody',t1);

    
var d1,d2,d3,d4,i1,i2;  
for(var i=0; i<10; i++) {
	var r1 = $e('tr',tb1);
		
		d1 = $e('td',r1,null,null,primlabels[2*i]);
		d2 = $e('td',r1,null,i==8?{'colspan':3}:null);
		if (i!=8) {
			d3 = $e('td',r1,null,null,primlabels[2*i+1]);
			d4 = $e('td',r1);
			i2=$e('input',d4,"slidervalue",{type:"number",maxlength:"2",name:"primnumber"+i,id:"primnumber"+i,value:"50",min:"1",max:"99"});
			i1=$e('input',d2,null,{type:"range",value:"50",min:"1",max:"99",step:"1",name:"primslider"+i,id:"primslider"+i,onchange:"globalvars['"+i2.id+"'].value=this.value;calculate()"});
			i1.onkeypress=slideronkeypress;
			i2.setAttribute("onchange","globalvars['"+i1.id+"'].value=this.value;calculate()");
		} else {
	
		//d1 = $e('td',r1,null,{'colspan':4});
                	d2 = $e('select',d2,null,{'size':1,id:"primslider"+i,onchange:"calculate()"},
			'<option value="___">Без бонусов ресурсов</option>'+
			'<option value="oem">ОEM (-5% Полет, +5% Повреждения)</option>'+
			'<option value="ome">OME (-5% Полет, +5% Прочность)</option>'+
			'<option value="eom">EOM (-5% Повреждения, +5% Полет)</option>'+
			'<option value="emo">EMO (-5% Повреждения, +5% Прочность)</option>'+
			'<option value="moe">MOE (-5% Прочность, +5% Полет)</option>'+
			'<option value="meo">MEO (-5% Прочность, +5% Повреждения)</option>');
			i2=$e('input',d2,null,{type:"number",maxlength:"2",name:"primnumber"+i,id:"primnumber"+i,visible:false}); // для совместимости
			
                }		

	
}








// var t2= $e('table',div3,'condensed-table');
// var tb2=$e('tbody',t2);

// for (var i=0; i<13; i++) {
// var r1 = $e('tr',tb2);
// var d1 = $e('td',r1,null,null,seclabels[i]);
// var d2 = $e('td',r1);
//var s1 = $e('span',d2,null,{id:"secpar"+i});}
//





	terttable=$e('table',div4,'condensed-table');
	terttable.ondblclick=ondblclick2;

var th2=$e('thead',terttable);
var tr1=$e('tr',th2);
		$e('th',tr1,null,null,'');
        $e('th',tr1,null,null,'название');
		$e('th',tr1,null,null,'значение');
		$e('th',tr1,null,null,'формула');
		$e('th',tr1,null,null,'min');
		$e('th',tr1,null,null,'max');
var tb2=$e('tbody',terttable);

for(var i=0;i<formulas.length;i++){
	var r1 = $e('tr',tb2);
	$e('input',$e('td',r1),null,{type:"checkbox"});
	
	$e('td',r1,null,{contenteditable:"true"},formulas[i]);
	$e('td',r1);
	$e('td',r1,null,{contenteditable:"true"},formulas[++i]);
	$e('td',r1);
	$e('td',r1);
}

for (var i=0;i<3;i++){

	r1 = $e('tr',tb2);
	$e('input',$e('td',r1),null,{type:"checkbox"});
	$e('td',r1,null,{contenteditable:"true"},'edit me!');$e('td',r1);$e('td',r1,null,{contenteditable:"true"},'0');$e('td',r1);$e('td',r1);
}

$e('span',div2,null,{id:'racetitle'},'');$e('br',div2);
$e('br',div2);$e('br',div2);
$e('button',div2,null,{onClick:'addtotable()'},'&darr; в таблицу, для сравнения &darr;');



var rollpanel=$e('div',popbody,null,{id:'rollpanel'});

theGroups = {   "1": "racesByGUser",
                "11": "Первый набор",
                "12": "Второй н" + "абор (с октября 2005 г.)",
                "13": "Третий набор (с сентября 2007 г.)",
                "2": "racesByMinka",
                "21": "ЕТУшники",
                "22": "Просто мясо",
                "23": "Научник-летун",
                "24": "Вассал-летун",
                "25": "Научник-вояка",
                "26": "Вассал-вояка",
                "27": "Научник-детектор",
                "28": "Вассал-детектор",
                "29": "Научник-невидимка",
                "2A": "Вассал-невидимка",
                "2B": "Вассал-детектор-невидимка",
                "3": "racesByKosta",
                "4": "racesByBlond" };

var spoilers=[];
var spoilersname=["Стандартные игровые расы","Большая подборка Миньки","Предложения Kost'ы","Предложения Tektronix'а"];

var temphref; 
//for (var i = 0; i <theRaces.length; i++) if (spoilers.indexOf(theRaces[i][9])==-1) {spoilers.push(theRaces[i][9])};

for (var i = 0; i <4; i++) {     
     $e('span',rollpanel,"icon",{id:'_'+theGroups[i+1]},i==0?"▼":"►");
     temphref=$e('a',rollpanel,null,{onClick:"javascript:showHide('"+theGroups[i+1]+"')"},spoilersname[i]);     
     
     $e('br',rollpanel);
     spoilers[i]=$e('div',rollpanel,null,{id:theGroups[i+1]},null,i==0?{display:"block"}:{display:"none"});     
}    

//console.log(spoilers); 
// for (var i = 1; i <= 5; i++) theRaces[i][11] = theRaces[0][11];
// theRaces[20][11] = theRaces[19][11];
// theRaces[31][11] = theRaces[29][11];
// theRaces[33][11] = theRaces[29][11];
// theRaces[34][11] = theRaces[0][11];
// theRaces[36][11] = theRaces[41][11];


for (var i = 0; i <theRaces.length; i++) {
	if (0==i || theRaces[i][9] != theRaces[i - 1][9]) $e('h7',spoilers[theRaces[i][9].substr(0, 1)-1],null,null,theGroups[theRaces[i][9]]);
	$e('button',spoilers[theRaces[i][9].substr(0, 1)-1],'racebutton',{onClick:'setsliders(['+theRaces[i].slice(1,9).join(',')+'])',title:theRaces[i][11]},theRaces[i][0]);
     $e('br',spoilers[theRaces[i][9].substr(0, 1)-1])
	//$e('br',rollpanel);
};

$e('button',div4,null,{onClick:'setsliders([50,50,50,50,50,50,50,50])'},'Grayers');$e('br',div4);
$e('button',div4,null,{onClick:'setsliders([99, 1,99,99,99,99, 1,99])'},'капитолий');  $e('br',div4);
$e('button',div4,null,{onClick:'setsliders([99,99, 1,99, 1, 1, 1,99])'},'Летун');  $e('br',div4);
$e('button',div4,null,{onClick:'setsliders([99, 1, 1,99,99,99, 1,99])'},'геолог'); $e('br',div4);
$e('button',div4,null,{onClick:'setsliders([51, 1,99, 1, 1, 1,99,99])'},'ПСН 99');$e('br',div4);
$e('button',div4,null,{onClick:'setsliders([51, 1,99,99, 1, 1,99,99])'},'ПСН 108');$e('br',div4);
$e('button',div4,null,{onClick:'setsliders([ 1,99, 1, 1, 1, 1,99,99])'},'Хитовик');$e('br',div4);
$e('button',div4,null,{onClick:'setsliders([99, 1, 1, 1, 1, 1,99, 1])'},'Пылевик');$e('br',div4);
$e('button',div4,null,{onClick:'setsliders([99, 67, 1, 99, 1, 1, 1, 99])'},'Skyman');$e('br',div4);


var elems=document.getElementsByTagName('*');
for(var i=0; i<elems.length; i++) if(elems[i].id) globalvars[elems[i].id]=elems[i];

if (parsehash().sliders)                               // сначала считаем без выставленного calcconst.nlmode
          setsliders(parsehash().sliders.split(','));  // либо у нас заданы значения ползунков и calculate вызывается уже из setsliders
     else  
          calculate();                                 // либо просто считаем
     


if (calcconst.nlmode=(parsehash().calcmode=='nl')) {
     var nlpanel=$e('div',popbody,null,{id:'nlpanel'});
     $e('label',nlpanel,null,null,'<input type=checkbox id=nlcheckbox onClick=nltrigger() checked>&nbsp;Нелинейный&nbsp;расчет',{'width':'initial'});
     //$e('input',null,null,{type:'checkbox'})
     globalvars['nlcheckbox']=document.getElementById('nlcheckbox');
}



if (parsehash().calcmode=='nl') {
     for (var i=0; i<nlAbacus.length; i++) {
          //sectable.rz.rows[i+1].cells[3].innerHTML='<img src="/ajax-loader.gif">';
          //sectable.rz.rows[i+1].cells[4].innerHTML='<img src="/ajax-loader.gif">';
     }
     setTimeout(calcmaxmin,100);
}

console.log('end main');



//document.querySelector("table.google-visualization-table-table").className='condensed-table';

}
	
	
</script>
<script type="text/javascript" src="/ga.js"></script>
</html>